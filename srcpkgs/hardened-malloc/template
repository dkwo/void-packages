# Template file for 'hardened-malloc'
pkgname=hardened-malloc
version=11
revision=1
archs="~i686* ~armv6l* ~armv7l*" # requires 64-bit
checkdepends="python3"
short_desc="Hardened allocator designed for modern systems"
maintainer="dkwo <npiazza@disroot.org>"
license="MIT"
homepage="https://github.com/GrapheneOS/hardened_malloc"
changelog="https://github.com/GrapheneOS/hardened_malloc/releases"
distfiles="https://github.com/GrapheneOS/hardened_malloc/archive/refs/tags/${version}.tar.gz"
checksum=14331990899b91f9323230c280d66f0d1a77c386eb5d206d4cd0d8b5683098da
nocross=yes

do_build() {
	make VARIANT=default
	make VARIANT=light
}

do_install() {
	vinstall out/libhardened_malloc.so 755 usr/lib/
	vinstall out-light/libhardened_malloc-light.so 755 usr/lib/
}

do_check() {
	make test
}

post_install() {
	vlicense LICENSE
}
